<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <title>Portf√≥lio Anal√≠tico: Simula√ß√£o de Funil Web e Documenta√ß√£o GTM/GA4</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-K75QBQZD');</script>
    
    <style>
        /* ESTILOS CSS REVISADOS */
        body { font-family: 'Roboto', Arial, sans-serif; margin: 0; padding: 0; background-color: #f0f2f5; color: #343a40; line-height: 1.6; }
        .header { background: linear-gradient(135deg, #004d99, #007bff); color: white; padding: 40px 20px; text-align: center; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2); }
        .container { max-width: 1000px; margin: 40px auto; padding: 0 20px; }
        
        /* Layout e Formul√°rio */
        .input-group { display: flex; flex-direction: column; margin-bottom: 15px; }
        .input-group label { margin-bottom: 5px; font-weight: bold; color: #495057; }
        
        input[type="text"], input[type="email"], input[type="date"], select { 
            padding: 12px; 
            border: 1px solid #ced4da; 
            border-radius: 6px; 
            width: 100%;
            box-sizing: border-box; 
            font-size: 16px;
        }
        .form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 20px; }
        
        /* Bot√µes de A√ß√£o */
        .funnel-nav button { 
            padding: 12px 25px; 
            border: none; 
            border-radius: 6px; 
            cursor: pointer; 
            font-weight: bold; 
            font-size: 16px;
            margin-right: 10px;
            transition: background-color 0.3s, transform 0.1s;
        }
        .btn-primary { background-color: #007bff; color: white; }
        .btn-primary:hover { background-color: #0056b3; transform: translateY(-1px); }
        .btn-secondary { background-color: #6c757d; color: white; }
        .btn-secondary:hover { background-color: #5a6268; }
        
        /* Cards de Produto */
        .product-card { 
            border: 2px solid #007bff; 
            background-color: #f8faff; 
            padding: 20px; 
            border-radius: 10px; 
            margin-bottom: 15px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .product-card:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(0, 123, 255, 0.15); }
        .product-details strong { color: #007bff; font-size: 1.1em; }
        .product-details span { display: block; }

        /* Status Bar */
        .status-bar { display: flex; margin-bottom: 20px; background-color: #e9ecef; border-radius: 4px; overflow: hidden; }
        .status-item { flex: 1; padding: 10px 0; text-align: center; color: #495057; font-weight: bold; background-color: #f1f1f1; transition: background-color 0.4s; }
        .status-item.current { background-color: #007bff; color: white; }

        /* Estilos de Abas */
        .tabs { display: flex; border-bottom: 2px solid #dee2e6; margin-bottom: 20px; }
        .tab-button { background-color: #f1f1f1; border: none; padding: 15px 25px; cursor: pointer; font-size: 16px; transition: background-color 0.3s, color 0.3s; margin-right: 5px; border-top-left-radius: 8px; border-top-right-radius: 8px; }
        .tab-button.active { background-color: white; color: #007bff; border-bottom: 2px solid white; margin-bottom: -2px; font-weight: bold; box-shadow: 0 -2px 5px rgba(0,0,0,0.05); }
        .tab-content { background: white; padding: 30px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05); }
        h2 { color: #007bff; border-bottom: 1px solid #dee2e6; padding-bottom: 10px; margin-top: 0; }
        .funnel-step-content { display: none; padding: 20px; border-radius: 5px; margin-top: 15px; }
        .funnel-step-content.active { display: block; }
        .tutorial-step { background-color: #f8f9fa; border: 1px solid #dee2e6; padding: 15px; border-radius: 5px; margin-bottom: 15px; }
        code { background-color: #eaf1f7; padding: 2px 4px; border-radius: 4px; color: #c0392b; font-size: 0.9em; }
    </style>
</head>
<body>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-K75QBQZD"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    
    <div class="header">
        <h1>Sandbox Web Analytics: Funil de Reservas ‚úàÔ∏è</h1>
        <p>Simula√ß√£o avan√ßada de rastreamento de funil, E-commerce Aprimorado e Propriedades de Usu√°rio.</p>
    </div>

    <div class="container">
        <div class="tabs">
            <button class="tab-button active" onclick="openTab(event, 'simulacao')">‚úàÔ∏è Simula√ß√£o de Funil Web (Laborat√≥rio)</button>
            <button class="tab-button" onclick="openTab(event, 'tutorial')">üìö Documenta√ß√£o do Projeto (Tutorial)</button>
        </div>

        <div id="simulacao" class="tab-content active">
            <h2>Funil de Passagens A√©reas: Teste de Eventos e Par√¢metros</h2>
            <p><strong>Instru√ß√£o:</strong> Avance nas etapas para disparar os eventos <code>view_search_results</code>, <code>select_item</code>, <code>begin_checkout</code> e <code>purchase</code>.</p>

            <div class="status-bar" id="funnel-status">
                <div class="status-item current" data-step="1">1. Pesquisa</div>
                <div class="status-item" data-step="2">2. Sele√ß√£o</div>
                <div class="status-item" data-step="3">3. Dados Pessoais</div>
                <div class="status-item" data-step="4">4. Purchase</div>
            </div>

            <div id="step-1" class="funnel-step-content active">
                <h3>1. Pesquisa de Voos (view_search_results)</h3>
                <p>Escolha a origem e o destino para simular uma busca.</p>
                <div class="form-row">
                    <div class="input-group">
                        <label for="origem">Origem (Aeroporto)</label>
                        <select id="origem">
                            <option value="GRU">GRU (S√£o Paulo)</option>
                            <option value="BSB">BSB (Bras√≠lia)</option>
                            <option value="VCP">VCP (Campinas)</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="destino">Destino (Aeroporto)</label>
                        <select id="destino">
                            <option value="GIG">GIG (Rio de Janeiro)</option>
                            <option value="FOR">FOR (Fortaleza)</option>
                            <option value="SSA">SSA (Salvador)</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="data_voo">Data do Voo</label>
                        <input type="date" id="data_voo" value="2025-12-15">
                    </div>
                </div>
                <div class="funnel-nav">
                    <button class="btn-primary" onclick="viewSearchResults('view_search_results')">üîç Pesquisar Voos</button>
                </div>
            </div>

            <div id="step-2" class="funnel-step-content">
                <h3>2. Sele√ß√£o de Voo (select_item)</h3>
                <p>Escolha a classe do voo para enviar o evento <code>select_item</code>.</p>
                
                <div class="product-card">
                    <div class="product-details">
                        <span>‚úàÔ∏è Voo LATAM LA3400 (Executiva)</span>
                        <strong>R$ 1.850,50</strong>
                    </div>
                    <button class="btn-primary button-analytics" onclick="selectFlight('Voo_LA3400', 'Executiva', 1850.50)">Selecionar Voo</button>
                </div>
                
                <div class="product-card">
                    <div class="product-details">
                        <span>‚úàÔ∏è Voo GOL G3200 (Econ√¥mica)</span>
                        <strong>R$ 890,00</strong>
                    </div>
                    <button class="btn-primary button-analytics" onclick="selectFlight('Voo_G3200', 'Econ√¥mica', 890.00)">Selecionar Voo</button>
                </div>

                <div class="funnel-nav" style="margin-top: 20px;">
                    <button class="btn-secondary" onclick="nextStep(1)">‚Üê Voltar √† Pesquisa</button>
                </div>
            </div>

            <div id="step-3" class="funnel-step-content">
                <h3>3. Dados Pessoais (begin_checkout)</h3>
                <p>Dados enviados no <code>begin_checkout</code>: Voo <span id="flight-id">---</span>, Valor: <span id="flight-price">---</span>.</p>
                
                <div class="form-row">
                    <div class="input-group">
                        <label for="nome_cliente">Nome Completo</label>
                        <input type="text" id="nome_cliente" value="Cliente Teste">
                    </div>
                    <div class="input-group">
                        <label for="email_cliente">E-mail</label>
                        <input type="email" id="email_cliente" value="teste@exemplo.com">
                    </div>
                </div>

                <div class="input-group" style="flex-direction: row; align-items: center;">
                    <input type="checkbox" id="pet_service" onchange="updatePriceWithPet()" style="width: auto; margin-right: 10px;">
                    <label for="pet_service" style="margin-bottom: 0; font-weight: normal;">üêæ Adicionar Servi√ßo Pet (R$ 100,00)</label>
                </div>

                <div class="funnel-nav" style="margin-top: 20px;">
                    <button class="btn-secondary" onclick="nextStep(2)">‚Üê Voltar √† Sele√ß√£o</button>
                    <button class="btn-primary" onclick="nextStep(4)">Continuar para o Pagamento ‚Üí</button>
                </div>
            </div>

            <div id="step-4" class="funnel-step-content">
                <h3>4. Purchase (Transa√ß√£o Final)</h3>
                <p>Confirme a compra. O evento <code>purchase</code> ser√° disparado com ID da transa√ß√£o e dados do cliente.</p>
                <div style="background-color: #e6f7ff; border: 1px solid #91d5ff; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                    <p>Valor Final com Servi√ßos: <strong><span id="final-price">---</span></strong></p>
                    <p>Cliente: <span id="summary-nome">---</span> | E-mail: <span id="summary-email">---</span></p>
                </div>
                
                <div class="funnel-nav">
                    <button class="btn-secondary" onclick="nextStep(3)">‚Üê Voltar aos Dados</button>
                    <button class="btn-primary" onclick="purchaseFlight()">üí∞ Finalizar Compra e Rastrear</button>
                </div>
            </div>
        </div>

        <div id="tutorial" class="tab-content" style="display:none;">
            <h2>Documenta√ß√£o do Projeto Anal√≠tico: Implementa√ß√£o GTM/GA4</h2>
            <div class="tutorial-step">
                <h3>1. Setup B√°sico (GA4, GTM & Hosting)</h3>
                <ul>
                    <li><strong>GA4:</strong> Cria√ß√£o de Propriedade e obten√ß√£o do ID de M√©trica (<code>G-XXXXX</code>).</li>
                    <li><strong>GTM:</strong> Cria√ß√£o de Cont√™iner Web e obten√ß√£o do ID (<code>GTM-SEU-ID</code>).</li>
                    <li><strong>Hosting:</strong> Uso do **GitHub Pages** para garantir um ambiente **<code>https://</code>** com acesso total ao &lt;head&gt;.</li>
                </ul>
            </div>
            
            <div class="tutorial-step">
                <h3>2. A Inje√ß√£o Correta do GTM</h3>
                <p>O snippet GTM foi colocado como o primeiro item dentro da tag <code>&lt;head&gt;</code> do arquivo <code>index.html</code>. Essa pr√°tica garante o carregamento ideal e a detec√ß√£o pelo Tag Assistant.</p>
                <pre>&lt;script&gt;... (Seu C√≥digo GTM) ...&lt;/script&gt;</pre>
            </div>
            
            <div class="tutorial-step">
                <h3>3. Estrat√©gia de Tagueamento (DataLayer)</h3>
                <p>Os eventos s√£o disparados por meio de cliques nos bot√µes do funil. Usamos o <code>dataLayer.push</code> para enviar dados ricos e descritivos ao GTM:</p>
                <pre>dataLayer.push({
    'event': 'select_item',
    'ecommerce': {
        'items': [...]
    }
});</pre>
                <p>Essa estrutura permite que o GTM crie **Tags de Evento GA4** que capturam todos os par√¢metros necess√°rios para an√°lise de funil e receita.</p>
            </div>
        </div>
    </div>
    
    <script>
        // Vari√°vel global para armazenar os dados do item selecionado
        let selectedFlight = {};
        let basePrice = 0;
        let finalPrice = 0;
        const PET_COST = 100.00;

        // -------------------------------------------------------------------
        // FUN√á√ïES DE NAVEGA√á√ÉO E STATUS (CORRIGIDAS)
        // -------------------------------------------------------------------
        function updateStatus(step) {
            document.querySelectorAll('.status-item').forEach(item => {
                item.classList.remove('current');
                if (parseInt(item.dataset.step) === step) {
                    item.classList.add('current');
                }
            });
        }

        function nextStep(nextStepNumber) {
            // Se estiver indo do passo 3 para o 4 (Purchase), atualiza o sum√°rio final
            if (nextStepNumber === 4) {
                // TRY/CATCH para evitar quebra caso os elementos n√£o existam
                try {
                    document.getElementById('summary-nome').innerText = document.getElementById('nome_cliente').value;
                    document.getElementById('summary-email').innerText = document.getElementById('email_cliente').value;
                } catch (e) {
                    console.warn('Erro ao atualizar sum√°rio. Elementos de input n√£o encontrados.', e);
                }
            }
            
            // Esconde todas as etapas
            document.querySelectorAll('.funnel-step-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Mostra a pr√≥xima etapa
            const nextElement = document.getElementById(`step-${nextStepNumber}`);
            if (nextElement) {
                nextElement.classList.add('active');
                console.log(`Funil: Avan√ßando para Etapa ${nextStepNumber}`);
            } else {
                console.error(`Erro: Elemento com ID 'step-${nextStepNumber}' n√£o encontrado!`);
                return;
            }

            updateStatus(nextStepNumber);
        }
        
        // -------------------------------------------------------------------
        // FUN√á√ïES DE C√ÅLCULO
        // -------------------------------------------------------------------
        function updatePriceDisplay(price) {
            const formattedPrice = `R$ ${price.toFixed(2)}`;
            document.getElementById('flight-price').innerText = formattedPrice;
            document.getElementById('final-price').innerText = formattedPrice;
        }

        function updatePriceWithPet() {
            const petCheckbox = document.getElementById('pet_service');
            finalPrice = basePrice;

            if (petCheckbox.checked) {
                finalPrice = basePrice + PET_COST;
            }

            updatePriceDisplay(finalPrice); 
            
            // Re-dispara o beginCheckout para atualizar o DataLayer em tempo real
            beginCheckout(true); 
        }

        // -------------------------------------------------------------------
        // FUN√á√ïES DATALAYER (GA4 Events)
        // -------------------------------------------------------------------
        function viewSearchResults(eventName) {
            const origin = document.getElementById('origem').value;
            const destination = document.getElementById('destino').value;

            // Dispara o evento view_search_results (Etapa 1)
            dataLayer.push({
                'event': eventName,
                'origem_voo': origin,
                'destino_voo': destination
            });
            console.log(`Event sent: ${eventName}`);

            // Avan√ßa para a pr√≥xima etapa (Etapa 2 - Sele√ß√£o)
            nextStep(2); 
        }

        function selectFlight(id, name, price) {
            selectedFlight = { id, name, price };
            basePrice = price;
            finalPrice = price;
            
            document.getElementById('pet_service').checked = false; 

            document.getElementById('flight-id').innerText = selectedFlight.id;
            updatePriceDisplay(finalPrice); 

            // Dispara o evento select_item (Etapa 2)
            dataLayer.push({
                'event': 'select_item',
                'ecommerce': {
                    'items': [{
                        item_id: selectedFlight.id,
                        item_name: selectedFlight.name,
                        price: selectedFlight.price,
                        currency: 'BRL',
                        quantity: 1
                    }]
                }
            });
            console.log(`Event sent: select_item with price ${price}`);

            // Avan√ßa para a pr√≥xima etapa (Checkout) e dispara begin_checkout
            beginCheckout();
        }
        
        function beginCheckout(isUpdate = false) {
            // Reconstroi a lista de itens (incluindo pet, se aplic√°vel)
            const checkoutItems = [{
                item_id: selectedFlight.id,
                item_name: selectedFlight.name,
                price: basePrice,
                currency: 'BRL',
                quantity: 1
            }];

            if (document.getElementById('pet_service') && document.getElementById('pet_service').checked) {
                checkoutItems.push({
                    item_id: 'SVC_PET',
                    item_name: 'Servi√ßo de Transporte Pet',
                    price: PET_COST,
                    currency: 'BRL',
                    quantity: 1
                });
            }


            // Dispara o evento begin_checkout (Etapa 3) com o pre√ßo final ajustado
            dataLayer.push({
                'event': 'begin_checkout',
                'ecommerce': {
                    'value': finalPrice,
                    'currency': 'BRL',
                    'items': checkoutItems
                }
            });
            console.log(`Event sent: begin_checkout with total value ${finalPrice}`);
            
            if (!isUpdate) {
                nextStep(3); // Apenas avan√ßa se n√£o for um update de pre√ßo
            }
        }

        function purchaseFlight() {
            if (!selectedFlight.id) {
                alert('Por favor, selecione um voo primeiro!');
                return;
            }

            const transactionId = 'T-' + Math.floor(Math.random() * 100000);
            
            const nome = document.getElementById('nome_cliente').value || "Cliente Teste";
            const email = document.getElementById('email_cliente').value || "teste@exemplo.com";
            
            // Reconstroi a lista de itens para o purchase (igual ao checkout)
            const purchaseItems = [{
                item_id: selectedFlight.id,
                item_name: selectedFlight.name,
                price: basePrice,
                currency: 'BRL',
                quantity: 1
            }];

            if (document.getElementById('pet_service').checked) {
                purchaseItems.push({
                    item_id: 'SVC_PET',
                    item_name: 'Servi√ßo de Transporte Pet',
                    price: PET_COST,
                    currency: 'BRL',
                    quantity: 1
                });
            }


            // Dispara o evento purchase (Convers√£o Final - Etapa 4)
            dataLayer.push({
                'event': 'purchase',
                'user_name': nome,
                'user_email': email,
                'ecommerce': {
                    'transaction_id': transactionId,
                    'value': finalPrice,
                    'currency': 'BRL',
                    'items': purchaseItems
                }
            });
            alert(`COMPRA FINALIZADA! Evento 'purchase' enviado com ID: ${transactionId}. Verifique no GA4!`);
            console.log(`Event sent: purchase with transaction ID ${transactionId}`);
            nextStep(4);
        }

        // -------------------------------------------------------------------
        // FUN√á√ïES DE CONTROLE DE ABAS (CORRIGIDAS)
        // -------------------------------------------------------------------
        function openTab(evt, tabName) {
            // Esconde todo o conte√∫do da aba
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.style.display = 'none';
            });

            // Remove a classe 'active' de todos os bot√µes
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });

            // Mostra o conte√∫do da aba atual e define o bot√£o como ativo
            const tabElement = document.getElementById(tabName);
            const buttonElement = evt.currentTarget;
            
            if (tabElement) {
                tabElement.style.display = 'block';
            } else {
                console.error(`Erro: Aba com ID '${tabName}' n√£o encontrada.`);
                return;
            }
            
            if (buttonElement) {
                buttonElement.classList.add('active');
            }

            console.log(`Aba: '${tabName}' ativada.`);
        }

        document.addEventListener('DOMContentLoaded', () => {
            // Garante que o passo 1 e a aba de simula√ß√£o estejam ativos ao carregar
            const step1 = document.getElementById('step-1');
            if(step1) step1.classList.add('active');
            
            const simulacaoTab = document.getElementById('simulacao');
            if(simulacaoTab) simulacaoTab.style.display = 'block';

            const simulacaoBtn = document.querySelector('.tab-button.active');
            if(simulacaoBtn) simulacaoBtn.classList.add('active');
        });

    </script>
</body>
</html>
