<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <title>Portf√≥lio Anal√≠tico: Simula√ß√£o de Funil Web e Documenta√ß√£o GTM/GA4</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-K75QBQZD');</script>
    <!-- End Google Tag Manager -->
    <style>
        /* Estilos Base e Layout */
        body { font-family: 'Roboto', Arial, sans-serif; margin: 0; padding: 0; background-color: #f8f9fa; color: #343a40; line-height: 1.6; }
        .header { background-color: #004d99; color: white; padding: 30px 20px; text-align: center; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); }
        .container { max-width: 1200px; margin: 40px auto; padding: 0 20px; }
        .tabs { display: flex; border-bottom: 2px solid #dee2e6; margin-bottom: 20px; }
        .tab-button { background-color: #f1f1f1; border: none; padding: 15px 25px; cursor: pointer; font-size: 16px; transition: background-color 0.3s, color 0.3s; margin-right: 5px; border-top-left-radius: 8px; border-top-right-radius: 8px; }
        .tab-button.active { background-color: white; color: #007bff; border-bottom: 2px solid white; margin-bottom: -2px; font-weight: bold; box-shadow: 0 -2px 5px rgba(0,0,0,0.05); }
        .tab-content { background: white; padding: 30px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05); }
        h2 { color: #007bff; border-bottom: 1px solid #dee2e6; padding-bottom: 10px; margin-top: 0; }
        h3 { color: #2c3e50; margin-top: 20px; }
        
        /* Estilos de Formul√°rio/Funil */
        .funnel-step-content { display: none; padding: 20px; border: 1px solid #e9ecef; border-radius: 5px; margin-top: 15px; }
        .funnel-step-content.active { display: block; }
        .funnel-nav button { margin-right: 10px; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; background-color: #28a745; color: white; transition: background-color 0.3s; }
        .funnel-nav button:hover { background-color: #218838; }
        input[type="text"], input[type="date"] { padding: 10px; margin-right: 10px; border: 1px solid #ced4da; border-radius: 4px; }
        .product-card { border: 1px solid #007bff; padding: 15px; border-radius: 5px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        .status-bar { display: flex; margin-bottom: 20px; background-color: #e9ecef; border-radius: 4px; overflow: hidden; }
        .status-item { flex: 1; padding: 10px 0; text-align: center; color: #495057; font-weight: bold; background-color: #f1f1f1; transition: background-color 0.4s; }
        .status-item.current { background-color: #007bff; color: white; }

        /* Estilos de Tutorial */
        .tutorial-step { background-color: #f8f9fa; border: 1px solid #dee2e6; padding: 15px; border-radius: 5px; margin-bottom: 15px; }
        code { background-color: #eaf1f7; padding: 2px 4px; border-radius: 4px; color: #c0392b; font-size: 0.9em; }
    </style>
</head>
<body>
    <div class="header">
        <h1>Sandbox Web Analytics: GTM/GA4 Web Funnel Analytics</h1>
        <p>Simula√ß√£o e documenta√ß√£o do processo de implementa√ß√£o de tagueamento de funil com dados avan√ßados.</p>
    </div>

    <div class="container">
        <div class="tabs">
            <button class="tab-button active" onclick="openTab(event, 'simulacao')">‚úàÔ∏è Simula√ß√£o de Funil Web (Laborat√≥rio)</button>
            <button class="tab-button" onclick="openTab(event, 'tutorial')">üìö Documenta√ß√£o do Projeto (Tutorial)</button>
        </div>

        <div id="simulacao" class="tab-content active">
            <h2>Funil de Passagens A√©reas: Teste de Eventos e Par√¢metros</h2>
            <p><strong>Instru√ß√£o:</strong> Use o **Tag Assistant** do GTM e clique em cada passo para rastrear o funil. Os eventos e dados est√£o em conformidade com o padr√£o de Enhanced E-commerce do GA4.</p>

            <div class="status-bar" id="funnel-status">
                <div class="status-item current" data-step="1">1. Pesquisa</div>
                <div class="status-item" data-step="2">2. Sele√ß√£o</div>
                <div class="status-item" data-step="3">3. Checkout</div>
                <div class="status-item" data-step="4">4. Purchase</div>
            </div>

            <div id="step-1" class="funnel-step-content active">
                <h3>1. Pesquisa de Voos (view_search_results)</h3>
                <p>Simula√ß√£o de busca por origem/destino.</p>
                <input type="text" id="origem" value="GRU" placeholder="Origem (ex: GRU)">
                <input type="text" id="destino" value="GIG" placeholder="Destino (ex: GIG)">
                <input type="date" id="data_voo" value="2025-12-15">
                <div class="funnel-nav" style="margin-top: 15px;">
                    <button onclick="nextStep(2, 'view_search_results')">Pesquisar Voos</button>
                </div>
            </div>

            <div id="step-2" class="funnel-step-content">
                <h3>2. Sele√ß√£o de Voo (select_item)</h3>
                <p>Simula√ß√£o de op√ß√µes de voo dispon√≠veis. Escolha uma para avan√ßar.</p>
                <div class="product-card">
                    <span>Voo LATAM LA3400 (Executiva) - 15/Dez</span>
                    <span><strong>R$ 1.850,50</strong></span>
                    <button class="button-analytics" onclick="selectFlight('Voo_LA3400', 'Executiva', 1850.50)">Selecionar</button>
                </div>
                <div class="product-card">
                    <span>Voo GOL G3200 (Econ√¥mica) - 15/Dez</span>
                    <span><strong>R$ 890,00</strong></span>
                    <button class="button-analytics" onclick="selectFlight('Voo_G3200', 'Econ√¥mica', 890.00)">Selecionar</button>
                </div>
            </div>

            <div id="step-3" class="funnel-step-content">
                <h3>3. In√≠cio do Checkout (begin_checkout)</h3>
                <p><strong>Sum√°rio:</strong> Voo <span id="flight-id">---</span>, Valor Total: <span id="flight-price">---</span>. (Dados enviados ao DataLayer).</p>
                <input type="text" placeholder="Nome Completo">
                <input type="text" placeholder="E-mail">
                <div class="funnel-nav" style="margin-top: 15px;">
                    <button onclick="nextStep(4, 'begin_checkout')">Confirmar Dados e Pagar</button>
                </div>
            </div>

            <div id="step-4" class="funnel-step-content">
                <h3>4. Purchase (Transa√ß√£o Final)</h3>
                <p>A√ß√£o final de convers√£o. O evento <code>purchase</code> √© crucial para a receita no GA4.</p>
                <p><strong>Valor Total Rastre√°vel:</strong> <span id="final-price">---</span></p>
                <div class="funnel-nav" style="margin-top: 15px;">
                    <button onclick="purchaseFlight()">Finalizar Compra e Rastrear</button>
                </div>
            </div>
        </div>

        <div id="tutorial" class="tab-content" style="display:none;">
            <h2>Documenta√ß√£o do Projeto Anal√≠tico: Implementa√ß√£o GTM/GA4</h2>
            <p>Este guia documenta o processo de setup, implementa√ß√£o e teste de eventos personalizados de funil para o Google Analytics 4 (GA4).</p>

            <div class="tutorial-step">
                <h3>1. Setup B√°sico (GA4, GTM & Hosting)</h3>
                <ul>
                    <li><strong>GA4:</strong> Cria√ß√£o de Propriedade e obten√ß√£o do ID de M√©trica (<code>G-XXXXX</code>).</li>
                    <li><strong>GTM:</strong> Cria√ß√£o de Cont√™iner Web e obten√ß√£o do ID (<code>GTM-SEU-ID</code>).</li>
                    <li><strong>Hosting:</strong> Uso do **GitHub Pages** para garantir um ambiente **<code>https://</code>** com acesso total ao &lt;head&gt;.</li>
                </ul>
            </div>
            
            <div class="tutorial-step">
                <h3>2. A Inje√ß√£o Correta do GTM</h3>
                <p>O snippet GTM foi colocado como o primeiro item dentro da tag <code>&lt;head&gt;</code> do arquivo <code>index.html</code>. Essa pr√°tica garante o carregamento ideal e a detec√ß√£o pelo Tag Assistant.</p>
                <pre>&lt;script&gt;... (Seu C√≥digo GTM) ...&lt;/script&gt;</pre>
            </div>
            
            <div class="tutorial-step">
                <h3>3. Estrat√©gia de Tagueamento (DataLayer)</h3>
                <p>Os eventos s√£o disparados por meio de cliques nos bot√µes do funil. Usamos o <code>dataLayer.push</code> para enviar dados ricos e descritivos ao GTM:</p>
                <pre>dataLayer.push({
    'event': 'select_item',
    'ecommerce': {
        'items': [...]
    }
});</pre>
                <p>Essa estrutura permite que o GTM crie **Tags de Evento GA4** que capturam todos os par√¢metros necess√°rios para an√°lise de funil e receita.</p>
            </div>
        </div>
    </div>

    <script>
        // Vari√°vel global para armazenar os dados do item selecionado
        let selectedFlight = {};
    
        // -------------------------------------------------------------------
        // FUN√á√ïES DE NAVEGA√á√ÉO E DATALAYER
        // -------------------------------------------------------------------
        function updateStatus(step) {
            document.querySelectorAll('.status-item').forEach(item => {
                item.classList.remove('current');
                if (parseInt(item.dataset.step) === step) {
                    item.classList.add('current');
                }
            });
        }
    
        function nextStep(nextStepNumber) {
            // Esconde todas as etapas e mostra a pr√≥xima
            document.querySelectorAll('.funnel-step-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`step-${nextStepNumber}`).classList.add('active');
    
            // Atualiza a barra de status
            updateStatus(nextStepNumber);
        }
    
        function viewSearchResults(eventName) {
            const origin = document.getElementById('origem').value;
            const destination = document.getElementById('destino').value;
    
            // Dispara o evento view_search_results (Etapa 1)
            dataLayer.push({
                'event': eventName,
                'origem_voo': origin,
                'destino_voo': destination
            });
            console.log(`Event sent: ${eventName}`);
    
            // Avan√ßa para a pr√≥xima etapa (Resultados)
            nextStep(2);
        }
    
        function selectFlight(id, name, price) {
            // Armazena os dados do voo e preenche o sum√°rio do checkout
            selectedFlight = { id, name, price };
    
            document.getElementById('flight-id').innerText = selectedFlight.id;
            document.getElementById('flight-price').innerText = `R$ ${selectedFlight.price.toFixed(2)}`;
            document.getElementById('final-price').innerText = `R$ ${selectedFlight.price.toFixed(2)}`;
    
            // Dispara o evento select_item (Etapa 2)
            dataLayer.push({
                'event': 'select_item',
                'ecommerce': {
                    'items': [{
                        item_id: selectedFlight.id,
                        item_name: selectedFlight.name,
                        price: selectedFlight.price,
                        currency: 'BRL',
                        quantity: 1
                    }]
                }
            });
            console.log(`Event sent: select_item with price ${price}`);
    
            // Avan√ßa para a pr√≥xima etapa (Checkout) e dispara begin_checkout
            beginCheckout();
        }
        
        // NOVO: Fun√ß√£o para disparar o evento de in√≠cio de checkout
        function beginCheckout() {
            // Dispara o evento begin_checkout (Etapa 3)
            dataLayer.push({
                'event': 'begin_checkout',
                'ecommerce': {
                    'value': selectedFlight.price,
                    'currency': 'BRL',
                    'items': [{
                        item_id: selectedFlight.id,
                        item_name: selectedFlight.name,
                        price: selectedFlight.price,
                        currency: 'BRL',
                        quantity: 1
                    }]
                }
            });
            console.log('Event sent: begin_checkout');
            nextStep(3);
        }
    
        function purchaseFlight() {
            if (!selectedFlight.id) {
                alert('Por favor, selecione um voo primeiro!');
                return;
            }
    
            const transactionId = 'T-' + Math.floor(Math.random() * 100000);
            
            // NOVO: Leitura dos dados do cliente (assumindo IDs 'nome_cliente' e 'email_cliente' no seu HTML)
            const nome = document.getElementById('nome_cliente').value || "Cliente Teste";
            const email = document.getElementById('email_cliente').value || "teste@exemplo.com";
    
    
            // Dispara o evento purchase (Convers√£o Final - Etapa 4)
            dataLayer.push({
                'event': 'purchase',
                // NOVOS PAR√ÇMETROS DE USU√ÅRIO
                'user_name': nome,
                'user_email': email,
                'ecommerce': {
                    'transaction_id': transactionId,
                    'value': selectedFlight.price,
                    'currency': 'BRL',
                    'items': [{
                        item_id: selectedFlight.id,
                        item_name: selectedFlight.name,
                        price: selectedFlight.price,
                        currency: 'BRL',
                        quantity: 1
                    }]
                }
            });
            alert(`COMPRA FINALIZADA! Evento 'purchase' enviado com ID: ${transactionId}. Verifique no GA4!`);
            console.log(`Event sent: purchase with transaction ID ${transactionId}`);
            nextStep(4);
        }
    
        // -------------------------------------------------------------------
        // FUN√á√ïES DE CONTROLE DE ABAS (mantidas)
        // -------------------------------------------------------------------
        function openTab(evt, tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.style.display = 'none';
            });
    
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
    
            document.getElementById(tabName).style.display = 'block';
            evt.currentTarget.classList.add('active');
        }
    
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('simulacao').style.display = 'block';
            // Chamada de viewSearchResults na p√°gina inicial, se necess√°rio.
        });
    
    </script>
</body>
</html>
